{% extends 'base.html' %} {% block title %}Busca por ...{% endblock %} {%block content %}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="card shadow-lg">
          <div class="card-body p-5">
            <h2 class="text-center mb-4">Busque serviços de bike</h2>
            <form method="POST" id="searchForm">
              {% csrf_token %}
              <div class="mb-3">
                <label for="id_country" class="form-label">País:</label>
                {{ form.country }}
              </div>
              <div class="mb-3">
                <label for="id_city" class="form-label">Cidade:</label>
                {{ form.city }}
              </div>
              <div class="d-grid mt-3">
                <button type="submit" class="btn btn-primary">Buscar</button>
              </div>
            </form>
  
            <!-- Spinner Container -->
            <div class="spinner-container mt-4 text-center" id="loadingSpinner">
              <div class="custom-spinner"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  

<script>
  $(document).ready(function () {
    // Mostrar o ícone de carregamento ao submeter o formulário
    $("#searchForm").submit(function (e) {
      $("#loadingSpinner").css("visibility", "visible"); // Exibe o spinner
    });

    // Atualizar as cidades com base no país selecionado
    $("#id_country").change(function () {
      var country = $(this).val();
      var url = "{% url 'get_cities_by_country' %}?country=" + country;

      $.get(url, function (data) {
        var citySelect = $("#id_city");
        citySelect.empty();

        $.each(data.cities, function (index, city) {
          citySelect.append(
            '<option value="' + city + '">' + city + "</option>"
          );
        });
      });
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}
